function addChip(e){if(game.playing&&!game.duringMove){const a=getFirstEmptyRow(e);if(-1!=a){game.array[a][e]=game.currentPlayer,game.duringMove=!0,$("#game").addClass("duringMove");const r=$("<div></div>").attr("id",`chip${a}_`+e).addClass("chip fall").css("--col",e).css("--row",-2).addClass(0==game.currentPlayer?"red":"yellow").appendTo("#inner");setTimeout(()=>{r.css("--row",a)},0),setTimeout(()=>{checkEnding()},600)}}}function getFirstEmptyRow(e){let a=game.rows[game.rows.length-1];for(;0<=a&&null!=game.array[a][e];)a--;return a}function highlightChips(e){for(const i of e){var[a,r]=i;$(`#chip${a}_`+r).addClass("highlight")}$("#scene").addClass("grow")}
function enableControls(){$("#playerForm").on("submit",createPlayers),$("#restartBtn").on("click",resetGame),$("#rotateLeftBtn").on("click",()=>rotateGame(1)),$("#rotateRightBtn").on("click",()=>rotateGame(-1))}
const game={winParam:4,array:[],currentPlayer:0,playing:!1,duringMove:!1,rows:[0,1,2,3,4,5],cols:[0,1,2,3,4,5,6],playerNames:["",""],directions:[[0,1],[1,0],[1,1],[0,-1],[-1,0],[-1,-1],[1,-1],[-1,1]],rotation:0};
$(()=>{$("#game").addClass("start").css("--rows",game.rows.length).css("--cols",game.cols.length),$("#modalContent").fadeIn("slow"),generateSlots(),resetArray(),enableControls()});
function createPlayers(e){e.preventDefault();var a=$("#playerName1").val(),e=$("#playerName2").val();0==a.length||0==e.length?$(".error").text("Please input a name for each player"):a==e?$(".error").text("Please input different names"):(game.playerNames=[a,e],startGame())}function setPlayer(e){$("body").removeClass("player"+game.currentPlayer).addClass("player"+e),$("#message").text(game.playerNames[e]+"'s turn"),game.currentPlayer=e}function switchPlayer(){setPlayer(1-game.currentPlayer)}
function resetArray(){game.array=new Array(game.rows.length).fill(null).map(()=>new Array(game.cols.length).fill(null))}function startGame(){game.playing=!0,setPlayer(randInt(0,2)),$("#modal").remove(),$("#status, menu").fadeIn("slow")}function resetGame(){removeChips(),resetArray(),$("#game").addClass("restart"),setTimeout(()=>{$("#game").removeClass("restart")},1e3),$("#scene").removeClass("grow"),$("#game").removeClass("duringMove"),$(".playerIcon").show(),setTimeout(()=>{setPlayer(randInt(0,2)),game.playing=!0},2e3)}function removeChips(){var e=getFirstNonEmptyRow();for(let t=e;t<game.rows.length;t++)setTimeout(()=>{for(const e of game.cols){const r=$(`#chip${t}_`+e).css("--row",-3);setTimeout(()=>r.remove(),600)}},200*(t-e))}function getFirstNonEmptyRow(){let e=0;for(;e<game.rows.length&&game.array[e].every(e=>null==e);)e++;return e}
function rotateGame(t){game.rotation+=22.5*t,(game.rotation-90)%180==0&&(game.rotation+=22.5*t),$("#game").css("--rotation-y",game.rotation+"deg")}
function generateSlots(){for(const o of game.rows)for(const a of game.cols)$("<div></div>").attr("id",`slot${o}_`+a).addClass("slot").appendTo(".frame").on("click",()=>addChip(a))}
function randInt(n,r){return n+Math.floor((r-n)*Math.random())}
function checkEnding(){game.duringMove=!1,game.playing=!1,isWon()?$("#message").text(game.playerNames[game.currentPlayer]+" has won! ðŸŽ‰"):hasOpenSlots()?($("#game").removeClass("duringMove"),game.playing=!0,switchPlayer()):($(".playerIcon").hide(),$("#message").text("The game has ended in a draw."))}function hasOpenSlots(){return game.array.some(e=>e.some(e=>null==e))}function isWonAt(a,n,e){var[s,r]=e;const g=[],o=[];for(let e=0;e<game.winParam;e++){if(!(0<=a+e*r&&a+e*r<game.rows.length&&0<=n+e*s&&n+e*s<game.cols.length))return!1;o.push([a+r*e,n+s*e]),g.push(game.array[a+r*e][n+s*e])}return 1==new Set(g).size&&(highlightChips(o),!0)}function isWon(){return game.rows.some(n=>game.cols.some(a=>null!=game.array[n][a]&&game.directions.some(e=>isWonAt(n,a,e))))}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoaXAuanMiLCJjb250cm9scy5qcyIsImdhbWUuanMiLCJtYWluLmpzIiwicGxheWVyLmpzIiwicmVzZXQuanMiLCJyb3RhdGUuanMiLCJzbG90cy5qcyIsInV0aWxzLmpzIiwid2luLmpzIl0sIm5hbWVzIjpbImFkZENoaXAiLCJjb2wiLCJnYW1lIiwicGxheWluZyIsImR1cmluZ01vdmUiLCJyb3ciLCJnZXRGaXJzdEVtcHR5Um93IiwiYXJyYXkiLCJjdXJyZW50UGxheWVyIiwiJCIsImFkZENsYXNzIiwiY2hpcCIsImF0dHIiLCJjc3MiLCJhcHBlbmRUbyIsInNldFRpbWVvdXQiLCJjaGVja0VuZGluZyIsImxldCIsInJvd3MiLCJsZW5ndGgiLCJoaWdobGlnaHRDaGlwcyIsImNvb3JkcyIsImNvb3JkIiwiZW5hYmxlQ29udHJvbHMiLCJvbiIsImNyZWF0ZVBsYXllcnMiLCJyZXNldEdhbWUiLCJyb3RhdGVHYW1lIiwid2luUGFyYW0iLCJjb2xzIiwicGxheWVyTmFtZXMiLCJkaXJlY3Rpb25zIiwicm90YXRpb24iLCJmYWRlSW4iLCJnZW5lcmF0ZVNsb3RzIiwicmVzZXRBcnJheSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInBsYXllcjEiLCJ2YWwiLCJwbGF5ZXIyIiwidGV4dCIsInN0YXJ0R2FtZSIsInNldFBsYXllciIsImluZGV4IiwicmVtb3ZlQ2xhc3MiLCJzd2l0Y2hQbGF5ZXIiLCJBcnJheSIsImZpbGwiLCJtYXAiLCJyYW5kSW50IiwicmVtb3ZlIiwicmVtb3ZlQ2hpcHMiLCJzaG93IiwiZmlyc3RSb3ciLCJnZXRGaXJzdE5vbkVtcHR5Um93IiwiZXZlcnkiLCJ4IiwiZGlyZWN0aW9uIiwiYSIsImIiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJpc1dvbiIsImhhc09wZW5TbG90cyIsImhpZGUiLCJzb21lIiwiaXNXb25BdCIsInhkaXIiLCJ5ZGlyIiwiZW50cmllcyIsImkiLCJwdXNoIiwiU2V0Iiwic2l6ZSJdLCJtYXBwaW5ncyI6IkFB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Q2pCdkQsZUFBZUMsSUFDUixHQU1mLFNBQVMyQyxRQUNMLE9BQU85RCxLQUFLZ0IsS0FBS2lELEtBQUssR0FDbEJqRSxLQUFLMkIsS0FBS3NDLEtBQ04sR0FDNEIsTUFBeEJqRSxLQUFLSyxNQUFNRixHQUFLSixJQUNoQkMsS0FBSzZCLFdBQVdvQyxLQUFLLEdBQ2pCQyxRQUFRL0QsRUFBS0osRUFBS3lEIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIGFkZENoaXAoY29sKSB7XHJcbiAgICBpZiAoIWdhbWUucGxheWluZyB8fCBnYW1lLmR1cmluZ01vdmUpIHJldHVybjtcclxuICAgIGNvbnN0IHJvdyA9IGdldEZpcnN0RW1wdHlSb3coY29sKTtcclxuICAgIGlmIChyb3cgPT0gLTEpIHJldHVybjtcclxuICAgIGdhbWUuYXJyYXlbcm93XVtjb2xdID0gZ2FtZS5jdXJyZW50UGxheWVyO1xyXG4gICAgZ2FtZS5kdXJpbmdNb3ZlID0gdHJ1ZTtcclxuICAgICQoXCIjZ2FtZVwiKS5hZGRDbGFzcyhcImR1cmluZ01vdmVcIik7XHJcbiAgICBjb25zdCBjaGlwID0gJChcIjxkaXY+PC9kaXY+XCIpXHJcbiAgICAgICAgLmF0dHIoXCJpZFwiLCBgY2hpcCR7cm93fV8ke2NvbH1gKVxyXG4gICAgICAgIC5hZGRDbGFzcyhcImNoaXAgZmFsbFwiKVxyXG4gICAgICAgIC5jc3MoXCItLWNvbFwiLCBjb2wpXHJcbiAgICAgICAgLmNzcyhcIi0tcm93XCIsIC0yKVxyXG4gICAgICAgIC5hZGRDbGFzcyhnYW1lLmN1cnJlbnRQbGF5ZXIgPT0gMCA/IFwicmVkXCIgOiBcInllbGxvd1wiKVxyXG4gICAgICAgIC5hcHBlbmRUbyhcIiNpbm5lclwiKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNoaXAuY3NzKFwiLS1yb3dcIiwgcm93KTtcclxuICAgIH0sIDApO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgY2hlY2tFbmRpbmcoKTtcclxuICAgIH0sIDYwMCk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEZpcnN0RW1wdHlSb3coY29sKSB7XHJcbiAgICBsZXQgcm93ID0gZ2FtZS5yb3dzW2dhbWUucm93cy5sZW5ndGggLSAxXTtcclxuICAgIHdoaWxlIChyb3cgPj0gMCAmJiBnYW1lLmFycmF5W3Jvd11bY29sXSAhPSBudWxsKSB7XHJcbiAgICAgICAgcm93LS07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcm93O1xyXG59XHJcblxyXG5mdW5jdGlvbiBoaWdobGlnaHRDaGlwcyhjb29yZHMpIHtcclxuICAgIGZvciAoY29uc3QgY29vcmQgb2YgY29vcmRzKSB7XHJcbiAgICAgICAgY29uc3QgW3JvdywgY29sXSA9IGNvb3JkO1xyXG4gICAgICAgICQoYCNjaGlwJHtyb3d9XyR7Y29sfWApLmFkZENsYXNzKFwiaGlnaGxpZ2h0XCIpO1xyXG4gICAgfVxyXG4gICAgJChcIiNzY2VuZVwiKS5hZGRDbGFzcyhcImdyb3dcIik7XHJcbn1cclxuIiwiZnVuY3Rpb24gZW5hYmxlQ29udHJvbHMoKSB7XHJcbiAgICAkKFwiI3BsYXllckZvcm1cIikub24oXCJzdWJtaXRcIiwgY3JlYXRlUGxheWVycyk7XHJcbiAgICAkKFwiI3Jlc3RhcnRCdG5cIikub24oXCJjbGlja1wiLCByZXNldEdhbWUpO1xyXG4gICAgJChcIiNyb3RhdGVMZWZ0QnRuXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gcm90YXRlR2FtZSgrMSkpO1xyXG4gICAgJChcIiNyb3RhdGVSaWdodEJ0blwiKS5vbihcImNsaWNrXCIsICgpID0+IHJvdGF0ZUdhbWUoLTEpKTtcclxufVxyXG4iLCJjb25zdCBnYW1lID0ge1xyXG4gICAgd2luUGFyYW06IDQsXHJcbiAgICBhcnJheTogW10sXHJcbiAgICBjdXJyZW50UGxheWVyOiAwLFxyXG4gICAgcGxheWluZzogZmFsc2UsXHJcbiAgICBkdXJpbmdNb3ZlOiBmYWxzZSxcclxuICAgIHJvd3M6IFswLCAxLCAyLCAzLCA0LCA1XSxcclxuICAgIGNvbHM6IFswLCAxLCAyLCAzLCA0LCA1LCA2XSxcclxuICAgIHBsYXllck5hbWVzOiBbXCJcIiwgXCJcIl0sXHJcbiAgICBkaXJlY3Rpb25zOiBbXHJcbiAgICAgICAgWzAsIDFdLFxyXG4gICAgICAgIFsxLCAwXSxcclxuICAgICAgICBbMSwgMV0sXHJcbiAgICAgICAgWzAsIC0xXSxcclxuICAgICAgICBbLTEsIDBdLFxyXG4gICAgICAgIFstMSwgLTFdLFxyXG4gICAgICAgIFsxLCAtMV0sXHJcbiAgICAgICAgWy0xLCAxXSxcclxuICAgIF0sXHJcbiAgICByb3RhdGlvbjogMCxcclxufTtcclxuIiwiJCgoKSA9PiB7XHJcbiAgICAkKFwiI2dhbWVcIilcclxuICAgICAgICAuYWRkQ2xhc3MoXCJzdGFydFwiKVxyXG4gICAgICAgIC5jc3MoXCItLXJvd3NcIiwgZ2FtZS5yb3dzLmxlbmd0aClcclxuICAgICAgICAuY3NzKFwiLS1jb2xzXCIsIGdhbWUuY29scy5sZW5ndGgpO1xyXG4gICAgJChcIiNtb2RhbENvbnRlbnRcIikuZmFkZUluKFwic2xvd1wiKTtcclxuICAgIGdlbmVyYXRlU2xvdHMoKTtcclxuICAgIHJlc2V0QXJyYXkoKTtcclxuICAgIGVuYWJsZUNvbnRyb2xzKCk7XHJcbn0pO1xyXG4iLCJmdW5jdGlvbiBjcmVhdGVQbGF5ZXJzKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGNvbnN0IHBsYXllcjEgPSAkKFwiI3BsYXllck5hbWUxXCIpLnZhbCgpO1xyXG4gICAgY29uc3QgcGxheWVyMiA9ICQoXCIjcGxheWVyTmFtZTJcIikudmFsKCk7XHJcbiAgICBpZiAocGxheWVyMS5sZW5ndGggPT0gMCB8fCBwbGF5ZXIyLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgJChcIi5lcnJvclwiKS50ZXh0KFwiUGxlYXNlIGlucHV0IGEgbmFtZSBmb3IgZWFjaCBwbGF5ZXJcIik7XHJcbiAgICB9IGVsc2UgaWYgKHBsYXllcjEgPT0gcGxheWVyMikge1xyXG4gICAgICAgICQoXCIuZXJyb3JcIikudGV4dChcIlBsZWFzZSBpbnB1dCBkaWZmZXJlbnQgbmFtZXNcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGdhbWUucGxheWVyTmFtZXMgPSBbcGxheWVyMSwgcGxheWVyMl07XHJcbiAgICAgICAgc3RhcnRHYW1lKCk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFBsYXllcihpbmRleCkge1xyXG4gICAgJChcImJvZHlcIilcclxuICAgICAgICAucmVtb3ZlQ2xhc3MoYHBsYXllciR7Z2FtZS5jdXJyZW50UGxheWVyfWApXHJcbiAgICAgICAgLmFkZENsYXNzKGBwbGF5ZXIke2luZGV4fWApO1xyXG4gICAgJChcIiNtZXNzYWdlXCIpLnRleHQoZ2FtZS5wbGF5ZXJOYW1lc1tpbmRleF0gKyBcIidzIHR1cm5cIik7XHJcbiAgICBnYW1lLmN1cnJlbnRQbGF5ZXIgPSBpbmRleDtcclxufVxyXG5cclxuZnVuY3Rpb24gc3dpdGNoUGxheWVyKCkge1xyXG4gICAgc2V0UGxheWVyKDEgLSBnYW1lLmN1cnJlbnRQbGF5ZXIpO1xyXG59XHJcbiIsImZ1bmN0aW9uIHJlc2V0QXJyYXkoKSB7XHJcbiAgICBnYW1lLmFycmF5ID0gbmV3IEFycmF5KGdhbWUucm93cy5sZW5ndGgpXHJcbiAgICAgICAgLmZpbGwobnVsbClcclxuICAgICAgICAubWFwKCgpID0+IG5ldyBBcnJheShnYW1lLmNvbHMubGVuZ3RoKS5maWxsKG51bGwpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gc3RhcnRHYW1lKCkge1xyXG4gICAgZ2FtZS5wbGF5aW5nID0gdHJ1ZTtcclxuICAgIHNldFBsYXllcihyYW5kSW50KDAsIDIpKTtcclxuICAgICQoXCIjbW9kYWxcIikucmVtb3ZlKCk7XHJcbiAgICAkKFwiI3N0YXR1cywgbWVudVwiKS5mYWRlSW4oXCJzbG93XCIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZXNldEdhbWUoKSB7XHJcbiAgICByZW1vdmVDaGlwcygpO1xyXG4gICAgcmVzZXRBcnJheSgpO1xyXG4gICAgJChcIiNnYW1lXCIpLmFkZENsYXNzKFwicmVzdGFydFwiKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICQoXCIjZ2FtZVwiKS5yZW1vdmVDbGFzcyhcInJlc3RhcnRcIik7XHJcbiAgICB9LCAxMDAwKTtcclxuICAgICQoXCIjc2NlbmVcIikucmVtb3ZlQ2xhc3MoXCJncm93XCIpO1xyXG4gICAgJChcIiNnYW1lXCIpLnJlbW92ZUNsYXNzKFwiZHVyaW5nTW92ZVwiKTtcclxuICAgICQoXCIucGxheWVySWNvblwiKS5zaG93KCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBzZXRQbGF5ZXIocmFuZEludCgwLCAyKSk7XHJcbiAgICAgICAgZ2FtZS5wbGF5aW5nID0gdHJ1ZTtcclxuICAgIH0sIDIwMDApO1xyXG59XHJcblxyXG5mdW5jdGlvbiByZW1vdmVDaGlwcygpIHtcclxuICAgIGNvbnN0IGZpcnN0Um93ID0gZ2V0Rmlyc3ROb25FbXB0eVJvdygpO1xyXG4gICAgZm9yIChsZXQgcm93ID0gZmlyc3RSb3c7IHJvdyA8IGdhbWUucm93cy5sZW5ndGg7IHJvdysrKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGZvciAoY29uc3QgY29sIG9mIGdhbWUuY29scykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2hpcCA9ICQoYCNjaGlwJHtyb3d9XyR7Y29sfWApLmNzcyhcIi0tcm93XCIsIC0zKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gY2hpcC5yZW1vdmUoKSwgNjAwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sIDIwMCAqIChyb3cgLSBmaXJzdFJvdykpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRGaXJzdE5vbkVtcHR5Um93KCkge1xyXG4gICAgbGV0IHJvdyA9IDA7XHJcbiAgICB3aGlsZSAoXHJcbiAgICAgICAgcm93IDwgZ2FtZS5yb3dzLmxlbmd0aCAmJlxyXG4gICAgICAgIGdhbWUuYXJyYXlbcm93XS5ldmVyeSgoeCkgPT4geCA9PSBudWxsKVxyXG4gICAgKSB7XHJcbiAgICAgICAgcm93Kys7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcm93O1xyXG59XHJcbiIsImZ1bmN0aW9uIHJvdGF0ZUdhbWUoZGlyZWN0aW9uKSB7XHJcbiAgICBnYW1lLnJvdGF0aW9uICs9IGRpcmVjdGlvbiAqICg5MCAvIDQpO1xyXG4gICAgaWYgKChnYW1lLnJvdGF0aW9uIC0gOTApICUgMTgwID09IDApIHtcclxuICAgICAgICBnYW1lLnJvdGF0aW9uICs9IGRpcmVjdGlvbiAqICg5MCAvIDQpO1xyXG4gICAgfVxyXG4gICAgJChcIiNnYW1lXCIpLmNzcyhcIi0tcm90YXRpb24teVwiLCBnYW1lLnJvdGF0aW9uICsgXCJkZWdcIik7XHJcbn1cclxuIiwiZnVuY3Rpb24gZ2VuZXJhdGVTbG90cygpIHtcclxuICAgIGZvciAoY29uc3Qgcm93IG9mIGdhbWUucm93cykge1xyXG4gICAgICAgIGZvciAoY29uc3QgY29sIG9mIGdhbWUuY29scykge1xyXG4gICAgICAgICAgICAkKFwiPGRpdj48L2Rpdj5cIilcclxuICAgICAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgYHNsb3Qke3Jvd31fJHtjb2x9YClcclxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhcInNsb3RcIilcclxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbyhcIi5mcmFtZVwiKVxyXG4gICAgICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgKCkgPT4gYWRkQ2hpcChjb2wpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIiwiZnVuY3Rpb24gcmFuZEludChhLCBiKSB7XHJcbiAgICByZXR1cm4gYSArIE1hdGguZmxvb3IoKGIgLSBhKSAqIE1hdGgucmFuZG9tKCkpO1xyXG59XHJcbiIsImZ1bmN0aW9uIGNoZWNrRW5kaW5nKCkge1xyXG4gICAgZ2FtZS5kdXJpbmdNb3ZlID0gZmFsc2U7XHJcbiAgICBnYW1lLnBsYXlpbmcgPSBmYWxzZTtcclxuICAgIGlmIChpc1dvbigpKSB7XHJcbiAgICAgICAgJChcIiNtZXNzYWdlXCIpLnRleHQoXHJcbiAgICAgICAgICAgIGdhbWUucGxheWVyTmFtZXNbZ2FtZS5jdXJyZW50UGxheWVyXSArIFwiIGhhcyB3b24hIPCfjolcIlxyXG4gICAgICAgICk7XHJcbiAgICB9IGVsc2UgaWYgKCFoYXNPcGVuU2xvdHMoKSkge1xyXG4gICAgICAgICQoXCIucGxheWVySWNvblwiKS5oaWRlKCk7XHJcbiAgICAgICAgJChcIiNtZXNzYWdlXCIpLnRleHQoXCJUaGUgZ2FtZSBoYXMgZW5kZWQgaW4gYSBkcmF3LlwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJChcIiNnYW1lXCIpLnJlbW92ZUNsYXNzKFwiZHVyaW5nTW92ZVwiKTtcclxuICAgICAgICBnYW1lLnBsYXlpbmcgPSB0cnVlO1xyXG4gICAgICAgIHN3aXRjaFBsYXllcigpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNPcGVuU2xvdHMoKSB7XHJcbiAgICByZXR1cm4gZ2FtZS5hcnJheS5zb21lKChyb3cpID0+IHJvdy5zb21lKCh4KSA9PiB4ID09IG51bGwpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gaXNXb25BdChyb3csIGNvbCwgZGlyZWN0aW9uKSB7XHJcbiAgICBjb25zdCBbeGRpciwgeWRpcl0gPSBkaXJlY3Rpb247XHJcbiAgICBjb25zdCBlbnRyaWVzID0gW107XHJcbiAgICBjb25zdCBjb29yZHMgPSBbXTtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ2FtZS53aW5QYXJhbTsgaSsrKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgICByb3cgKyBpICogeWRpciA+PSAwICYmXHJcbiAgICAgICAgICAgIHJvdyArIGkgKiB5ZGlyIDwgZ2FtZS5yb3dzLmxlbmd0aCAmJlxyXG4gICAgICAgICAgICBjb2wgKyBpICogeGRpciA+PSAwICYmXHJcbiAgICAgICAgICAgIGNvbCArIGkgKiB4ZGlyIDwgZ2FtZS5jb2xzLmxlbmd0aFxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgICBjb29yZHMucHVzaChbcm93ICsgeWRpciAqIGksIGNvbCArIHhkaXIgKiBpXSk7XHJcbiAgICAgICAgICAgIGVudHJpZXMucHVzaChnYW1lLmFycmF5W3JvdyArIHlkaXIgKiBpXVtjb2wgKyB4ZGlyICogaV0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAobmV3IFNldChlbnRyaWVzKS5zaXplID09IDEpIHtcclxuICAgICAgICBoaWdobGlnaHRDaGlwcyhjb29yZHMpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzV29uKCkge1xyXG4gICAgcmV0dXJuIGdhbWUucm93cy5zb21lKChyb3cpID0+XHJcbiAgICAgICAgZ2FtZS5jb2xzLnNvbWUoXHJcbiAgICAgICAgICAgIChjb2wpID0+XHJcbiAgICAgICAgICAgICAgICBnYW1lLmFycmF5W3Jvd11bY29sXSAhPSBudWxsICYmXHJcbiAgICAgICAgICAgICAgICBnYW1lLmRpcmVjdGlvbnMuc29tZSgoZGlyZWN0aW9uKSA9PlxyXG4gICAgICAgICAgICAgICAgICAgIGlzV29uQXQocm93LCBjb2wsIGRpcmVjdGlvbilcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICApXHJcbiAgICApO1xyXG59XHJcbiJdfQ==
